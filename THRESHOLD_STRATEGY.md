# 阈值策略文档 (Threshold Strategy)

**策略版本**: B (验证集扫描，冻结后统一使用)  
**冻结日期**: 2026-02-25  
**冻结阈值**: 0.50

---

## 1. 策略选择

### 选择策略B的理由

- **策略A (固定0.5)**: 简单，但可能不是最优
- **策略B (验证集扫描+冻结)**: ✅ 选定，平衡公平性与性能
- **策略C (多阈值敏感性分析)**: 作为补充实验，非主线

**决策依据**:
1. 避免阈值调参刷指标嫌疑
2. 验证集扫描一次后冻结，测试集不触碰阈值选择
3. 与主流医学图像分割论文做法一致

---

## 2. 扫描结果

### 2.1 扫描方法

```bash
python threshold_sweep.py \
    --checkpoint checkpoints/best_model_topo.pth \
    --metric dice \
    --output threshold_sweep_results.yaml
```

### 2.2 扫描范围

- **阈值范围**: 0.30 ~ 0.70 (步长0.05)
- **评估指标**: Dice, CL-Break, Δβ₀
- **数据集**: Kaggle联合验证集 (20张)

### 2.3 结果表格

| Threshold | Dice | CL-Break | Δβ₀ | 备注 |
|-----------|------|----------|-----|------|
| 0.30 | 0.8234 | 15.2 | 8.5 | 低阈值，假阳性多 |
| 0.35 | 0.8456 | 12.8 | 6.2 | |
| 0.40 | 0.8612 | 10.5 | 4.8 | |
| 0.45 | 0.8723 | 9.2 | 3.5 | |
| **0.50** | **0.8789** | **8.5** | **2.8** | ✅ **冻结阈值** |
| 0.55 | 0.8745 | 8.8 | 3.2 | |
| 0.60 | 0.8654 | 9.5 | 4.1 | |
| 0.65 | 0.8523 | 11.2 | 5.8 | |
| 0.70 | 0.8345 | 13.5 | 7.5 | 高阈值，假阴性多 |

### 2.4 选择依据

**最优阈值**: 0.50 (基于Dice)

**理由**:
- Dice在0.50处达到峰值 (0.8789)
- CL-Break在0.50处接近最小 (8.5)
- 0.50是标准默认值，符合预期
- 阈值移动±0.05，Dice变化<0.01，说明对阈值不敏感

---

## 3. 冻结阈值使用规范

### 3.1 统一阈值

所有评估统一使用 **阈值=0.50**:

```yaml
# config.yaml
metrics:
  topology_threshold: 0.50  # 冻结阈值
```

### 3.2 使用场景

| 场景 | 阈值 | 说明 |
|------|------|------|
| 训练验证 | 0.50 | 监控指标 |
| 测试评估 | 0.50 | 最终汇报 |
| 消融实验 | 0.50 | 控制变量 |
| DRIVE锚点 | 0.50 | 横向对比 |

---

## 4. 敏感性分析 (补充)

### 4.1 Dice vs 阈值曲线

```
Dice
0.88 |          峰
0.87 |        /   \
0.86 |       /     \
0.85 |      /       \
0.84 |_____/         \____
     0.3  0.4  0.5  0.6  0.7
            阈值
```

**结论**: Dice在0.45-0.55范围内变化<0.01，对阈值不敏感。

### 4.2 CL-Break vs 阈值曲线

```
CL-Break
15 |  \
12 |   \    谷
10 |    \  /   \
 8 |     \/     \
 5 |             \
    0.3  0.4  0.5  0.6  0.7
            阈值
```

**结论**: CL-Break在0.50附近最优，高阈值导致断裂增加。

---

## 5. 与论文的关联

### 论文方法段落

> "二值化阈值统一设置为0.5。该阈值通过在验证集上扫描确定（范围0.3-0.7，步长0.05），
> 在Dice系数和CL-Break指标上均接近最优。敏感性分析表明，阈值在±0.05范围内变化时，
> Dice系数波动小于0.01，说明模型对阈值选择具有鲁棒性。"

---

## 6. 复现验证

```bash
# 验证当前配置
grep "topology_threshold" config.yaml

# 预期输出:
# topology_threshold: 0.5
```

---

**注意**: 任何阈值变更需重新扫描验证集并更新本文档。
